## 钱包业务背景介绍

> 虚拟钱包账户都会对应用户的一个真实的支付账户，有可能是银行卡账户，也有可能是三方支付账户（比如支付宝、微信钱包）。

### 充值

> 用户通过三方支付渠道，把自己银行卡账户内的钱，充值到虚拟钱包账号中。

- 三个主要的操作流程：
    - 是从用户的银行卡账户转账到应用的公共银行卡账户；
    - 将用户的充值金额加到虚拟钱包余额上；
    - 记录刚刚这笔交易流水。

### 支付

> 用户用钱包内的余额，支付购买应用内的商品。实际上，支付的过程就是一个转账的过程，从用户的虚拟钱包账户划钱到商家的虚拟钱包账户上。记录这笔支付的交易流水信息。

### 提现

> 用户将虚拟钱包中的余额，提现到自己的银行卡中。这个过程实际上就是扣减用户虚拟钱包中的余额，并且触发真正的银行转账操作，从应用的公共银行账户转钱到用户的银行账户。同样，我们也需要记录这笔提现的交易流水信息。

### 查询余额

> 用户查询虚拟钱包中的余额数字。

### 查询交易流水

> 支持三种类型的交易流水：充值、支付、提现。在用户充值、支付、提现的时候，我们会记录相应的交易信息。在需要查询的时候，只需要将之前记录的交易流水，按照时间、类型等条件过滤之后，显示出来即可。

## 钱包系统的设计思路

- 整个钱包系统的业务划分为两部分
    - 单纯跟应用内的虚拟钱包账户打交道;
    - 单纯跟银行账户打交道。

- 拟钱包系统要支持的操作非常简单，就是余额的加加减减。
    - 充值、提现、查询余额三个功能，只涉及一个账户余额的加减操作;
    - 而支付功能涉及两个账户的余额加减操作：一个账户减余额，另一个账户加余额。

- 交易流水该如何记录和查询？
    ```text
    交易流水ID 交易时间 交易金额 交易类型 入账钱包账号 出账钱包账号
                                |
                               \|/
                           充值、提现、支付
    ```

## 基于贫血模型(Anemic Domain Model)的传统开发模式

### Web 后端项目的三层架构

### VirtualWalletController

### VirtualWalletService

## 基于充血模型(Rich Domain Model)的 DDD(Domain Driven Design) 开发模式

### VirtualWallet

### VirtualWalletService

## 辩证思考和灵活应用

### Service类的职责

### Controller 层和Repository 层的设计
